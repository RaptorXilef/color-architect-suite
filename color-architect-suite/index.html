<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Felix Maywald / RaptorXilef">
    <meta name="copyright" content="¬© [2025] Felix Maywald">
    <title>Color Architect Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=Fira+Code:wght@400;500&display=swap');
        
        :root {
            --panel-bg: #1e293b;
            --app-bg: #0f172a;
            --accent: #3b82f6;
        }

        body { background-color: var(--app-bg); color: #f8fafc; font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
        .card { background: var(--panel-bg); border: 1px solid #334155; border-radius: 1.25rem; box-shadow: 0 20px 50px rgba(0,0,0,0.4); }
        
        /* Custom Inputs */
        input[type="color"] { -webkit-appearance: none; border: none; width: 100%; height: 50px; cursor: pointer; border-radius: 0.75rem; background: #334155; padding: 4px; }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: none; border-radius: 0.5rem; }
        
        input[type="text"], input[type="number"], select { background: #0f172a; border: 1px solid #334155; padding: 0.75rem; border-radius: 0.75rem; color: white; width: 100%; text-align: center; font-family: 'Fira Code', monospace; font-size: 0.875rem; outline: none; }
        input:focus { border-color: var(--accent); }

        /* Tabs Navigation */
        .tab-btn { transition: all 0.2s; border-bottom: 3px solid transparent; color: #64748b; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.65rem; padding: 1rem 0.5rem; white-space: nowrap; }
        .tab-btn.active { border-bottom-color: var(--accent); color: var(--accent); background: rgba(59, 130, 246, 0.05); }

        .code-block { background: #0a0f1e; border-radius: 0.75rem; padding: 1.25rem; font-family: 'Fira Code', monospace; font-size: 0.8rem; border: 1px solid #1e293b; position: relative; overflow-x: auto; color: #94a3b8; }
        .copy-btn { position: absolute; top: 0.75rem; right: 0.75rem; background: #334155; padding: 0.3rem 0.6rem; border-radius: 0.4rem; font-size: 0.65rem; cursor: pointer; color: #cbd5e1; font-weight: bold; }
        .copy-btn:hover { background: var(--accent); color: white; }

        .custom-range { -webkit-appearance: none; width: 100%; height: 6px; background: #334155; border-radius: 5px; outline: none; }
        .custom-range::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: var(--accent); cursor: pointer; border-radius: 50%; border: 3px solid #f8fafc; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .tab-panel { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Grid for Glass Preview */
        .glass-bg-pattern {
            background-image: radial-gradient(circle at 2px 2px, rgba(255,255,255,0.15) 1px, transparent 0);
            background-size: 32px 32px;
        }

        .blob { position: absolute; border-radius: 50%; filter: blur(40px); opacity: 0.6; z-index: 0; animation: float 10s infinite ease-in-out; }
        @keyframes float { 
            0%, 100% { transform: translate(0, 0); } 
            50% { transform: translate(20px, -20px); } 
        }
    </style>
</head>
<body class="p-4 md:p-12 flex flex-col items-center">

    <div class="max-w-6xl w-full">
        <header class="mb-12 text-center">
            <h1 class="text-5xl font-black tracking-tighter bg-clip-text text-transparent bg-gradient-to-r from-blue-400 via-indigo-500 to-emerald-400 uppercase">
                Color Architect Suite
            </h1>
            <p class="text-slate-400 mt-4 text-lg font-medium">Design-Engineering f√ºr Perfektionisten</p>
        </header>

        <div class="overflow-x-auto w-full mb-12 no-scrollbar">
            <nav class="flex min-w-max justify-start md:justify-center space-x-2 md:space-x-4 border-b border-slate-800">
                <button onclick="showTab('mix')" id="tab-mix" class="tab-btn active">Mix</button>
                <button onclick="showTab('contrast')" id="tab-contrast" class="tab-btn">Contrast</button>
                <button onclick="showTab('rule')" id="tab-rule" class="tab-btn">60-30-10</button>
                <button onclick="showTab('semantic')" id="tab-semantic" class="tab-btn">Semantics</button>
                <button onclick="showTab('scale')" id="tab-scale" class="tab-btn">Scale Pro</button>
                <button onclick="showTab('explorer')" id="tab-explorer" class="tab-btn">Explorer</button>
                <button onclick="showTab('quiet')" id="tab-quiet" class="tab-btn">Theme</button>
                <button onclick="showTab('glass')" id="tab-glass" class="tab-btn">Glass</button>
                <button onclick="showTab('grad')" id="tab-grad" class="tab-btn">Gradient</button>
                <button onclick="showTab('typo')" id="tab-typo" class="tab-btn text-purple-400">Typo Scale</button>
                <button onclick="showTab('shadow')" id="tab-shadow" class="tab-btn text-pink-400">Shadow Pro</button>
            </nav>
        </div>

        <div class="space-y-10">
            <!-- 1. MIX ANALYZER -->
            <div id="panel-mix" class="tab-panel">
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="card p-10">
                        <h2 class="text-2xl font-bold mb-8 flex items-center"><span class="mr-3 text-blue-400">üß™</span> SCSS Mix-Calculator</h2>
                        <div class="space-y-8">
                            <div>
                                <label class="block text-[11px] font-black uppercase text-slate-500 mb-3">Basisfarbe</label>
                                <input type="color" id="mixBaseColor" value="#3b82f6" oninput="syncHex('mixBaseColor', 'mixBaseHex'); updateMix();">
                                <input type="text" id="mixBaseHex" value="#3B82F6" onchange="syncColor('mixBaseHex', 'mixBaseColor'); updateMix();" class="mt-3">
                            </div>
                            <div>
                                <label class="block text-[11px] font-black uppercase text-slate-500 mb-3">Ziel-Farbe</label>
                                <input type="color" id="mixTargetColor" value="#1d4ed8" oninput="syncHex('mixTargetColor', 'mixTargetHex'); updateMix();">
                                <input type="text" id="mixTargetHex" value="#1D4ED8" onchange="syncColor('mixTargetHex', 'mixTargetColor'); updateMix();" class="mt-3">
                            </div>
                        </div>
                    </div>
                    <div class="card p-10 bg-slate-900/40 border-dashed border-slate-700">
                        <h3 class="text-xs font-black text-slate-500 uppercase mb-6">Ergebnis f√ºr SCSS</h3>
                        <div class="code-block text-emerald-400"><button class="copy-btn" onclick="copyContent(event, 'mixOutput')">Copy</button><code id="mixOutput"></code></div>
                    </div>
                </div>
            </div>

            <!-- 2. CONTRAST -->
            <div id="panel-contrast" class="tab-panel hidden">
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="card p-10">
                        <h2 class="text-2xl font-bold mb-8">üëÅÔ∏è WCAG & YIQ Analyzer</h2>
                        <input type="color" id="conBgColor" value="#3b82f6" oninput="updateContrast();">
                        <div class="pt-8 border-t border-slate-700 grid grid-cols-2 gap-6 mt-8">
                            <div><label class="block text-[10px] font-bold text-slate-500 mb-2 uppercase">Dark Text</label><input type="color" id="conDarkText" value="#0f172a" oninput="updateContrast();"></div>
                            <div><label class="block text-[10px] font-bold text-slate-500 mb-2 uppercase">Light Text</label><input type="color" id="conLightText" value="#f8fafc" oninput="updateContrast();"></div>
                        </div>
                    </div>
                    <div class="card overflow-hidden flex flex-col shadow-2xl">
                        <div id="conPreview" class="flex-grow p-16 flex flex-col items-center justify-center text-center transition-all duration-500">
                            <h3 id="conPreviewText" class="text-4xl font-black mb-4 uppercase">Vorschau</h3>
                            <p id="ratioRes" class="text-xl font-mono font-bold"></p>
                        </div>
                        <div id="wcagBadge" class="p-4 text-center text-xs font-black uppercase tracking-widest text-white">Check...</div>
                    </div>
                </div>
            </div>

            <!-- 3. 60-30-10 -->
            <div id="panel-rule" class="tab-panel hidden">
                <div class="card p-10">
                    <div class="flex justify-between items-center mb-12">
                        <h2 class="text-2xl font-bold">üìê 60-30-10 Rule</h2>
                        <div class="flex p-1 bg-slate-900 rounded-xl border border-slate-700">
                            <button onclick="setRuleMode('light')" id="rule-l" class="px-6 py-2 text-[11px] font-black rounded-lg uppercase">Light</button>
                            <button onclick="setRuleMode('dark')" id="rule-d" class="px-6 py-2 text-[11px] font-black rounded-lg uppercase ml-2 bg-blue-600">Dark</button>
                        </div>
                    </div>
                    <div class="grid md:grid-cols-3 gap-12">
                        <input type="color" id="ruleAccent" value="#3b82f6" oninput="updateRule();">
                        <div class="md:col-span-2 space-y-8">
                            <div class="h-32 rounded-2xl flex overflow-hidden shadow-2xl border border-slate-800" id="ruleBar"></div>
                            <div class="code-block text-blue-300"><pre id="ruleOutput" class="text-xs"></pre></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4. SEMANTICS -->
            <div id="panel-semantic" class="tab-panel hidden">
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="card p-10">
                        <h2 class="text-2xl font-bold mb-6">üé® UI Semantics</h2>
                        <input type="color" id="semBase" value="#3b82f6" oninput="updateSemantic();">
                    </div>
                    <div class="md:col-span-2 card p-10">
                        <div class="grid grid-cols-2 gap-6" id="semContainer"></div>
                        <div class="code-block mt-8 text-emerald-400"><pre id="semOutput" class="text-xs"></pre></div>
                    </div>
                </div>
            </div>

            <!-- 5. SCALE PRO -->
            <div id="panel-scale" class="tab-panel hidden">
                <div class="card p-10">
                    <div class="flex justify-between items-center mb-10">
                        <h2 class="text-2xl font-bold">ü™ú Scale Pro</h2>
                        <div class="flex p-1 bg-slate-900 rounded-xl border border-slate-700">
                            <button onclick="setScaleType('mono')" id="sc-mono" class="px-5 py-2 text-[10px] font-black rounded-lg uppercase bg-blue-600">Mono</button>
                            <button onclick="setScaleType('duo')" id="sc-duo" class="px-5 py-2 text-[10px] font-black rounded-lg uppercase ml-2">Duo</button>
                        </div>
                    </div>
                    <div class="grid md:grid-cols-4 gap-10">
                        <div class="space-y-4">
                            <div><label class="block text-[10px] font-bold text-slate-500 mb-2 uppercase">Basis A</label><input type="color" id="scaleA" value="#3b82f6" oninput="updateScale();"></div>
                            <div id="scaleBWrapper" class="hidden"><label class="block text-[10px] font-bold text-slate-500 mb-2 uppercase">Ende B</label><input type="color" id="scaleB" value="#10b981" oninput="updateScale();"></div>
                            <div><label class="block text-[10px] font-bold text-slate-500 mb-2 uppercase">Schritte: <span id="scCountText">7</span></label><input type="range" id="scaleCount" min="3" max="15" step="2" value="7" oninput="updateScale();" class="custom-range"></div>
                        </div>
                        <div class="md:col-span-3 space-y-8">
                            <div id="scalePreview" class="h-20 flex rounded-2xl overflow-hidden shadow-xl border border-slate-700"></div>
                            <div class="code-block text-blue-300"><pre id="scaleOutput" class="text-xs"></pre></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 6. EXPLORER -->
            <div id="panel-explorer" class="tab-panel hidden">
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="card p-10">
                        <h2 class="text-2xl font-bold mb-6">üîç Explorer</h2>
                        <input type="color" id="expBase" value="#0f172a" oninput="updateExplorer();">
                    </div>
                    <div class="md:col-span-2 space-y-4 max-h-[500px] overflow-y-auto pr-2 no-scrollbar" id="expResults"></div>
                </div>
            </div>

            <!-- 7. THEME ARCHITECT -->
            <div id="panel-quiet" class="tab-panel hidden">
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="card p-10 border-emerald-500/20">
                        <h2 class="text-2xl font-bold text-emerald-400 mb-8">üåø Theme Architect</h2>
                        <input type="color" id="quietBase" value="#0A192F" oninput="updateQuiet();">
                        <div class="flex p-1 bg-slate-900 rounded-xl border border-slate-800 mt-8">
                            <button onclick="setThemeMode('light')" id="tm-l" class="flex-1 py-2 text-[10px] font-black rounded-lg uppercase">Light</button>
                            <button onclick="setThemeMode('dark')" id="tm-d" class="flex-1 py-2 text-[10px] font-black rounded-lg uppercase ml-2 bg-blue-600">Dark</button>
                        </div>
                    </div>
                    <div class="md:col-span-2 space-y-8">
                        <div id="uiPreview" class="rounded-3xl p-8 flex border transition-all duration-500 shadow-2xl relative overflow-hidden" style="min-height: 250px;">
                            <div id="uiSidebar" class="w-1/3 rounded-2xl p-4 border transition-all duration-500 mr-6">
                                <div class="w-full h-4 rounded-full opacity-20 mb-3 bg-current"></div>
                                <div class="w-2/3 h-4 rounded-full opacity-10 bg-current"></div>
                            </div>
                            <div id="uiContent" class="flex-1 rounded-2xl p-6 border transition-all duration-500 relative text-white">
                                <h4 class="font-bold text-lg mb-4 uppercase tracking-tighter">UI Preview</h4>
                                <div class="w-full h-24 rounded-xl mb-4 bg-current opacity-5 border border-current"></div>
                            </div>
                        </div>
                        <div class="code-block text-emerald-300"><button class="copy-btn" onclick="copyContent(event, 'quietOutput')">Copy</button><pre id="quietOutput" class="text-xs"></pre></div>
                    </div>
                </div>
            </div>

            <!-- 8. GLASS ARCHITECT -->
            <div id="panel-glass" class="tab-panel hidden">
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="card p-10">
                        <h2 class="text-2xl font-bold text-emerald-400 mb-8 uppercase">üíé Glass Architect</h2>
                        <div class="space-y-6">
                            <div><label class="block text-[11px] text-slate-500 mb-2 uppercase">Kontext (Border)</label><input type="color" id="glassContext" value="#0f172a" oninput="updateGlass();"></div>
                            <div><label class="block text-[11px] text-slate-500 mb-2 uppercase">Hintergrund</label><input type="color" id="glassVisualBg" value="#1e293b" oninput="updateGlass();"></div>
                            <input type="file" id="glassImageInput" accept="image/*" onchange="handleGlassImage(this)" class="block w-full text-[10px] text-slate-500 cursor-pointer">
                            <div><label class="block text-[10px] text-slate-500 mb-2 uppercase">Deckkraft: <span id="glassOpacityVal">20%</span></label><input type="range" id="glassOpacity" min="5" max="60" step="5" value="20" oninput="updateGlass();" class="custom-range"></div>
                            <div><label class="block text-[10px] text-slate-500 mb-2 uppercase">Blur: <span id="glassBlurVal">12px</span></label><input type="range" id="glassBlur" min="0" max="40" step="1" value="12" oninput="updateGlass();" class="custom-range"></div>
                        </div>
                    </div>
                    <div class="md:col-span-2 space-y-8">
                        <div id="glassPreviewContainer" class="rounded-3xl p-16 glass-bg-pattern flex items-center justify-center relative overflow-hidden border border-slate-800 shadow-2xl bg-cover bg-center transition-all duration-500" style="min-height: 450px;">
                            <!-- Floating decorative blobs for blur assessment -->
                            <div class="blob w-32 h-32 bg-blue-500" style="top: 20%; left: 20%; animation-delay: 0s;"></div>
                            <div class="blob w-24 h-24 bg-emerald-400" style="bottom: 30%; right: 25%; animation-delay: -2s;"></div>
                            <div class="blob w-40 h-40 bg-purple-600" style="top: 50%; left: 60%; animation-delay: -5s;"></div>
                            
                            <div id="glassPreviewPane" class="w-full max-w-sm p-12 rounded-3xl border transition-all duration-300 relative z-10 text-center">
                                <h4 class="text-2xl font-black mb-4 uppercase">Frosted Glass</h4>
                                <p class="text-sm opacity-80">Mathematische Rahmung & Weichzeichnung.</p>
                            </div>
                        </div>
                        <div class="code-block text-emerald-300"><button class="copy-btn" onclick="copyContent(event, 'glassOutput')">Copy</button><pre id="glassOutput" class="text-xs"></pre></div>
                    </div>
                </div>
            </div>

            <!-- 9. GRADIENT LAB -->
            <div id="panel-grad" class="tab-panel hidden">
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="card p-10">
                        <h2 class="text-2xl font-bold text-orange-400 mb-8 uppercase">üî• Gradient Lab</h2>
                        <div class="grid grid-cols-2 gap-4 mb-6"><input type="color" id="gradStart" value="#3b82f6" oninput="updateGradient();"><input type="color" id="gradEnd" value="#10b981" oninput="updateGradient();"></div>
                        <input type="range" id="gradAngle" min="0" max="360" step="15" value="135" oninput="updateGradient();" class="custom-range mb-6">
                        <div class="flex items-center space-x-2 p-3 bg-slate-900 rounded-lg">
                            <input type="checkbox" id="gradSoft" onchange="updateGradient();" class="w-4 h-4"><label class="text-xs font-bold uppercase text-slate-400">Soft Transition</label>
                        </div>
                    </div>
                    <div class="md:col-span-2 space-y-8">
                        <div id="gradPreview" class="rounded-3xl h-64 shadow-2xl border border-slate-800 transition-all duration-500"></div>
                        <div class="code-block text-emerald-300"><pre id="gradOutput" class="text-xs"></pre></div>
                    </div>
                </div>
            </div>

            <!-- 10. TYPOGRAPHY SCALE -->
            <div id="panel-typo" class="tab-panel hidden">
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="card p-10">
                        <h2 class="text-2xl font-bold text-purple-400 mb-8 uppercase">üìè Typo Scale</h2>
                        <div class="space-y-8">
                            <input type="number" id="typoBase" value="16" min="12" max="24" oninput="updateTypo();">
                            <select id="typoRatio" onchange="updateTypo();">
                                <option value="1.067">Minor Second (1.067)</option>
                                <option value="1.125">Major Second (1.125)</option>
                                <option value="1.200">Minor Third (1.200)</option>
                                <option value="1.250" selected>Major Third (1.250)</option>
                                <option value="1.333">Perfect Fourth (1.333)</option>
                                <option value="1.618">Golden Ratio (1.618)</option>
                            </select>
                        </div>
                    </div>
                    <div class="md:col-span-2 space-y-8">
                        <div class="card p-10"><div id="typoPreview" class="space-y-6"></div></div>
                        <div class="code-block text-purple-300"><pre id="typoOutput" class="text-xs"></pre></div>
                    </div>
                </div>
            </div>

            <!-- 11. SHADOW PRO -->
            <div id="panel-shadow" class="tab-panel hidden">
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="card p-10">
                        <h2 class="text-2xl font-bold text-pink-400 mb-8 uppercase">üåë Shadow Pro</h2>
                        <div class="space-y-8">
                            <input type="color" id="shadColor" value="#000000" oninput="updateShadow();">
                            <input type="range" id="shadIntensity" min="5" max="50" step="1" value="20" oninput="updateShadow();" class="custom-range">
                        </div>
                    </div>
                    <div class="md:col-span-2 space-y-8">
                        <div class="h-64 rounded-3xl bg-slate-800 flex items-center justify-center border border-slate-700">
                            <div id="shadPreviewBox" class="w-32 h-32 bg-slate-100 rounded-3xl shadow-xl"></div>
                        </div>
                        <div class="code-block text-pink-300"><pre id="shadOutput" class="text-xs"></pre></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBALS ---
        let ruleMode = 'dark';
        let scaleType = 'mono';
        let themeMode = 'dark';

        // --- MATH HELPERS ---
        function safeHexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? { r: parseInt(result[1], 16), g: parseInt(result[2], 16), b: parseInt(result[3], 16) } : {r:0,g:0,b:0};
        }
        const rgbToHex = (r, g, b) => "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        const mix = (c1, c2, w) => {
            const r = Math.round(c1.r * w + c2.r * (1-w)), g = Math.round(c1.g * w + c2.g * (1-w)), b = Math.round(c1.b * w + c2.b * (1-w));
            return { r, g, b, hex: rgbToHex(r,g,b) };
        };
        const getYIQ = (rgb) => ((rgb.r * 299) + (rgb.g * 587) + (rgb.b * 114)) / 1000;
        const getLuminance = (rgb) => {
            let a = [rgb.r, rgb.g, rgb.b].map(v => { v /= 255; return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4); });
            return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;
        };
        const getContrast = (c1, c2) => {
            let l1 = getLuminance(c1) + 0.05, l2 = getLuminance(c2) + 0.05;
            return l1 > l2 ? l1 / l2 : l2 / l1;
        };
        const rgbToHsl = (r, g, b) => {
            r /= 255, g /= 255, b /= 255;
            let max = Math.max(r, g, b), min = Math.min(r, g, b), h, s, l = (max + min) / 2;
            if(max == min) { h = s = 0; } else {
                let d = max - min; s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch(max){ case r: h = (g - b) / d + (g < b ? 6 : 0); break; case g: h = (b - r) / d + 2; break; case b: h = (r - g) / d + 4; break; }
                h /= 6;
            } return { h: h * 360, s: s * 100, l: l * 100 };
        };
        const hslToRgb = (h, s, l) => {
            s /= 100; l /= 100; h /= 360;
            let r, g, b;
            if(s == 0){ r = g = b = l; } else {
                const q2r = (p, q, t) => { if(t < 0) t += 1; if(t > 1) t -= 1; if(t < 1/6) return p + (q - p) * 6 * t; if(t < 1/2) return q; if(t < 2/3) return p + (q - p) * (2/3 - t) * 6; return p; };
                let q = l < 0.5 ? l * (1 + s) : l + s - l * s, p = 2 * l - q;
                r = q2r(p, q, h + 1/3); g = q2r(p, q, h); b = q2r(p, q, h - 1/3);
            } return { r: Math.round(r * 255), g: Math.round(g * 255), b: Math.round(b * 255), hex: rgbToHex(Math.round(r*255), Math.round(g*255), Math.round(b*255)) };
        };

        // --- UI ---
        function showTab(id) {
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            const panel = document.getElementById('panel-' + id);
            if(panel) panel.classList.remove('hidden');
            const btn = document.getElementById('tab-' + id);
            if(btn) btn.classList.add('active');
        }
        function syncHex(cId, hId) { document.getElementById(hId).value = document.getElementById(cId).value.toUpperCase(); }
        function syncColor(hId, cId) { if(/^#[0-9A-F]{6}$/i.test(document.getElementById(hId).value)) document.getElementById(cId).value = document.getElementById(hId).value; }
        function copyContent(e, id) {
            const ta = document.createElement("textarea"); ta.value = document.getElementById(id).innerText; document.body.appendChild(ta); ta.select(); document.execCommand("copy"); document.body.removeChild(ta);
            const btn = e.currentTarget; const old = btn.innerText; btn.innerText = "Copied!"; setTimeout(()=>btn.innerText = old, 1200);
        }

        // --- UPDATERS ---
        function updateMix() {
            const b = safeHexToRgb(document.getElementById('mixBaseColor').value), t = safeHexToRgb(document.getElementById('mixTargetColor').value);
            const bA = (b.r+b.g+b.b)/3, tA = (t.r+t.g+t.b)/3;
            let partner = tA > bA ? {r:255, g:255, b:255, name:'white'} : {r:0, g:0, b:0, name:'black'};
            const ds = [(t.r-b.r)/(partner.r-b.r), (t.g-b.g)/(partner.g-b.g), (t.b-b.b)/(partner.b-b.b)].filter(v=>isFinite(v)&&!isNaN(v));
            const p = ds.length > 0 ? Math.round((ds.reduce((x,y)=>x+y)/ds.length)*100) : 0;
            document.getElementById('mixOutput').innerText = `mix(${partner.name}, $brand-primary, ${Math.max(0, p)}%)`;
        }

        function updateContrast() {
            const bgHex = document.getElementById('conBgColor').value;
            const bg = safeHexToRgb(bgHex), isL = getYIQ(bg) >= 128;
            const darkH = document.getElementById('conDarkText').value, lightH = document.getElementById('conLightText').value;
            const txt = isL ? safeHexToRgb(darkH) : safeHexToRgb(lightH);
            const r = getContrast(bg, txt).toFixed(2);
            document.getElementById('conPreview').style.backgroundColor = bgHex;
            document.getElementById('conPreviewText').style.color = isL ? darkH : lightH;
            document.getElementById('ratioRes').innerText = `${r} : 1`;
            const b = document.getElementById('wcagBadge'); 
            b.innerText = r >= 4.5 ? (r >= 7 ? "AAA - EXZELLENT" : "AA - BESTANDEN") : "KRITISCH";
            b.style.backgroundColor = r >= 4.5 ? "#10b981" : "#ef4444";
        }

        function setRuleMode(m) { ruleMode = m; updateRule(); }
        function updateRule() {
            const accH = document.getElementById('ruleAccent').value;
            const acc = safeHexToRgb(accH);
            let b = ruleMode === 'light' ? "#F8FAFC" : "#0F172A", s = ruleMode === 'light' ? mix(acc, {r:255,g:255,b:255}, 0.1).hex : mix(acc, {r:15,g:23,b:42}, 0.15).hex;
            document.getElementById('ruleBar').innerHTML = `<div style="width:60%; background:${b}"></div><div style="width:30%; background:${s}"></div><div style="width:10%; background:${accH}"></div>`;
            document.getElementById('ruleOutput').innerText = `$base: ${b};\n$secondary: ${s};\n$accent: ${accH};`;
            document.getElementById('rule-l').classList.toggle('bg-blue-600', ruleMode==='light');
            document.getElementById('rule-d').classList.toggle('bg-blue-600', ruleMode==='dark');
        }

        function updateSemantic() {
            const bH = document.getElementById('semBase').value, brand = safeHexToRgb(bH);
            const states = [{n:'Info', c:{r:59,g:130,b:246}}, {n:'Success', c:{r:34,g:197,b:94}}, {n:'Warning', c:{r:234,g:179,b:8}}, {n:'Danger', c:{r:239,g:68,b:68}}];
            const cont = document.getElementById('semContainer'); cont.innerHTML = '';
            let scss = '$semantic-tokens: (\n';
            states.forEach(s => {
                const tint = mix(brand, s.c, 0.2), isL = getYIQ(tint) >= 128, txt = isL ? "#000" : "#fff";
                cont.innerHTML += `<div class="p-5 rounded-2xl flex flex-col items-center justify-center font-bold text-xs shadow-lg" style="background:${tint.hex}; color:${txt}"><span>${s.n}</span><span class="opacity-50 font-mono mt-1 text-[10px]">${tint.hex}</span></div>`;
                scss += `  "${s.n.toLowerCase()}": ( "bg": ${tint.hex}, "text": ${txt} ),\n`;
            });
            scss += ');'; document.getElementById('semOutput').innerText = scss;
        }

        function setScaleType(t) { scaleType = t; updateScale(); }
        function updateScale() {
            const aH = document.getElementById('scaleA').value, bH = document.getElementById('scaleB').value;
            const a = safeHexToRgb(aH), b = safeHexToRgb(bH), count = parseInt(document.getElementById('scaleCount').value);
            document.getElementById('scCountText').innerText = count;
            document.getElementById('sc-mono').classList.toggle('bg-blue-600', scaleType==='mono');
            document.getElementById('sc-duo').classList.toggle('bg-blue-600', scaleType==='duo');
            document.getElementById('scaleBWrapper').classList.toggle('hidden', scaleType!=='duo');
            const prev = document.getElementById('scalePreview'); prev.innerHTML = '';
            let scss = '$color-scale: (\n';
            for(let i=0; i<count; i++) {
                const w = i / (count-1);
                let c = scaleType === 'mono' ? (w < 0.5 ? mix(a, {r:255,g:255,b:255}, w*2) : mix({r:0,g:0,b:0}, a, (w-0.5)*2)) : mix(b, a, w);
                prev.innerHTML += `<div style="flex:1; background:${c.hex}"></div>`;
                scss += `  "${(i+1)*100}": ${c.hex},\n`;
            }
            scss += ');'; document.getElementById('scaleOutput').innerText = scss;
        }

        function updateExplorer() {
            const bH = document.getElementById('expBase').value, bg = safeHexToRgb(bH), hsl = rgbToHsl(bg.r, bg.g, bg.b), res = document.getElementById('expResults'); res.innerHTML = '';
            const hars = [{n:'Komplement√§r', h:180}, {n:'Triadisch A', h:120}, {n:'Triadisch B', h:240}, {n:'Analog A', h:30}, {n:'Analog B', h:330}];
            hars.forEach(h => {
                const acc = hslToRgb((hsl.h + h.h) % 360, Math.max(hsl.s, 60), Math.max(hsl.l, 50)), ratio = getContrast(bg, acc).toFixed(1);
                res.innerHTML += `<div class="card p-5 flex items-center justify-between border-l-4" style="border-left-color:${acc.hex}">
                    <div><p class="text-[10px] font-bold text-slate-500 uppercase">${h.n}</p><p class="font-mono text-sm">${acc.hex}</p></div>
                    <div class="flex items-center space-x-6"><div class="px-4 py-2 rounded-lg font-bold text-xs shadow" style="background:${acc.hex}; color:${getYIQ(acc)>=128?'#000':'#fff'}">Button</div><div class="text-right text-sm font-bold ${ratio>=4.5?'text-emerald-400':'text-red-400'}">${ratio}:1</div></div>
                </div>`;
            });
        }

        function setThemeMode(m) { themeMode = m; updateQuiet(); }
        function updateQuiet() {
            const bH = document.getElementById('quietBase').value, bg = safeHexToRgb(bH), isD = themeMode === 'dark';
            document.getElementById('tm-l').classList.toggle('bg-blue-600', themeMode==='light');
            document.getElementById('tm-d').classList.toggle('bg-blue-600', themeMode==='dark');
            let surf, side, bord, shad, txt = isD ? "#FFF" : "#0F172A";
            if(isD) { surf = mix({r:255,g:255,b:255}, bg, 0.05); side = mix({r:0,g:0,b:0}, bg, 0.15); bord = mix({r:255,g:255,b:255}, bg, 0.15); shad = mix({r:0,g:0,b:0}, bg, 0.40); }
            else { surf = mix({r:0,g:0,b:0}, bg, 0.03); side = mix({r:0,g:0,b:0}, bg, 0.08); bord = mix({r:0,g:0,b:0}, bg, 0.12); shad = mix({r:0,g:0,b:0}, bg, 0.10); }
            const p = document.getElementById('uiPreview'); p.style.backgroundColor = bH; p.style.color = txt; p.style.borderColor = bord.hex;
            document.getElementById('uiSidebar').style.backgroundColor = side.hex; document.getElementById('uiSidebar').style.borderColor = bord.hex;
            document.getElementById('uiContent').style.backgroundColor = surf.hex; document.getElementById('uiContent').style.borderColor = bord.hex;
            document.getElementById('quietOutput').innerText = `$bg: ${bH};\n$surface: ${surf.hex};\n$sidebar: ${side.hex};\n$border: ${bord.hex};\n$shadow: ${shad.hex};`;
        }

        function handleGlassImage(i) { const f = i.files[0]; if(!f) return; const r = new FileReader(); r.onload = (e) => document.getElementById('glassPreviewContainer').style.backgroundImage = `url(${e.target.result})`; r.readAsDataURL(f); }
        function updateGlass() {
            const ctxH = document.getElementById('glassContext').value, vbgH = document.getElementById('glassVisualBg').value;
            const ctx = safeHexToRgb(ctxH), vbg = safeHexToRgb(vbgH), op = document.getElementById('glassOpacity').value/100, blur = document.getElementById('glassBlur').value;
            document.getElementById('glassOpacityVal').innerText = (op*100) + "%"; document.getElementById('glassBlurVal').innerText = blur + "px";
            document.getElementById('glassPreviewContainer').style.backgroundColor = vbgH;
            const isL = getYIQ(ctx) >= 128, tint = isL ? {r:0,g:0,b:0} : {r:255,g:255,b:255}, bRgb = mix(ctx, tint, 0.8), bRgba = `rgba(${bRgb.r},${bRgb.g},${bRgb.b},0.3)`;
            const pRgba = isL ? `rgba(255,255,255,${op})` : `rgba(${ctx.r},${ctx.g},${ctx.b},${op})`, txt = getYIQ(vbg) >= 128 ? "#000" : "#fff";
            const pane = document.getElementById('glassPreviewPane'); pane.style.background = pRgba; pane.style.backdropFilter = `blur(${blur}px)`; pane.style.webkitBackdropFilter = `blur(${blur}px)`; pane.style.borderColor = bRgba; pane.style.color = txt;
            document.getElementById('glassOutput').innerText = `.glass-card {\n  background: ${pRgba};\n  backdrop-filter: blur(${blur}px);\n  border: 1px solid ${bRgba};\n}`;
        }

        function updateGradient() {
            const s = document.getElementById('gradStart').value, e = document.getElementById('gradEnd').value, ang = document.getElementById('gradAngle').value, soft = document.getElementById('gradSoft').checked;
            document.getElementById('gradAngleVal').innerText = ang + "deg";
            let css = soft ? `linear-gradient(${ang}deg, ${s} 0%, ${mix(safeHexToRgb(s), safeHexToRgb(e), 0.5).hex} 50%, ${e} 100%)` : `linear-gradient(${ang}deg, ${s}, ${e})`;
            document.getElementById('gradPreview').style.background = css; document.getElementById('gradOutput').innerText = `background: ${css};`;
        }

        function updateTypo() {
            const base = parseInt(document.getElementById('typoBase').value), ratio = parseFloat(document.getElementById('typoRatio').value);
            const prev = document.getElementById('typoPreview'); prev.innerHTML = '';
            let scss = '$typo-scale: (\n';
            const ns = ['4xl', '3xl', '2xl', 'xl', 'lg', 'base', 'sm', 'xs'];
            ns.forEach((n, i) => {
                const s = (base * Math.pow(ratio, 4 - i)).toFixed(2);
                prev.innerHTML += `<div class="flex items-baseline"><span class="w-12 text-[10px] font-black opacity-40 uppercase">${n}</span><span style="font-size:${s}px" class="font-bold truncate">Interface Typography</span><span class="ml-auto text-[10px] font-mono opacity-30">${s}px</span></div>`;
                scss += `  "${n}": ${s}px,\n`;
            });
            scss += ');'; document.getElementById('typoOutput').innerText = scss;
        }

        function updateShadow() {
            const cH = document.getElementById('shadColor').value, c = safeHexToRgb(cH), i = parseInt(document.getElementById('shadIntensity').value) / 100;
            const ls = [{y:1,b:2,o:0.1*i}, {y:4,b:8,o:0.2*i}, {y:12,b:24,o:0.3*i}, {y:32,b:64,o:0.4*i}];
            const css = ls.map(l => `0 ${l.y}px ${l.b}px rgba(${c.r},${c.g},${c.b},${l.o.toFixed(2)})`).join(', ');
            document.getElementById('shadPreviewBox').style.boxShadow = css;
            document.getElementById('shadOutput').innerText = `box-shadow: ${css};`;
        }

        // --- INIT ALL TOOLS ---
        window.onload = () => {
            updateMix(); updateContrast(); updateRule(); updateSemantic(); updateScale(); updateExplorer(); updateQuiet(); updateGlass(); updateGradient(); updateTypo(); updateShadow();
        };
    </script>
</body>
</html>